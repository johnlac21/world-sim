generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model World {
  id          Int    @id @default(autoincrement())
  name        String
  currentYear Int    @default(0)

  // One-to-many: world → countries
  countries Country[] @relation("WorldCountries")

  people    Person[]
  companies Company[]
  schools   School[]
  offices   Office[]

  // One-to-one: which country the user controls
  controlledCountryId Int?     @unique
  controlledCountry   Country? @relation("ControlledCountry", fields: [controlledCountryId], references: [id])

  createdAt DateTime @default(now())
}

model Country {
  id   Int    @id @default(autoincrement())
  name String

  // Back to world (regular one-to-many, MUST use same name)
  world   World @relation("WorldCountries", fields: [worldId], references: [id])
  worldId Int

  people    Person[]
  companies Company[]
  schools   School[]
  offices   Office[]

  // Back-rel for controlledCountry (no fields here, FK lives on World)
  controlledByWorld World? @relation("ControlledCountry")
}

model Person {
  id      Int   @id @default(autoincrement())
  world   World @relation(fields: [worldId], references: [id])
  worldId Int

  country   Country? @relation(fields: [countryId], references: [id])
  countryId Int?

  name      String
  birthYear Int
  age       Int

  // =========================
  // Cognitive stats
  // =========================
  intelligence Int
  memory       Int
  creativity   Int
  discipline   Int
  judgment     Int
  adaptability Int

  // =========================
  // Social / Influence stats
  // =========================
  charisma      Int
  leadership    Int
  empathy       Int
  communication Int
  confidence    Int
  negotiation   Int

  // =========================
  // Physical stats
  // =========================
  strength    Int
  endurance   Int
  athleticism Int
  vitality    Int
  reflexes    Int
  appearance  Int

  // =========================
  // Personality stats
  // =========================
  ambition      Int
  integrity     Int
  riskTaking    Int
  patience      Int
  agreeableness Int
  stability     Int

  // =========================
  // Potential & development
  // =========================
  potentialOverall Int    @default(60)
  peakAge          Int    @default(35)
  developmentStyle String @default("NORMAL") // "EARLY" | "NORMAL" | "LATE" | "VOLATILE"

  // =========================
  // Personality system
  // =========================
  personalityArchetype String // e.g. "Visionary", "Leader"
  personalitySubtype  String // e.g. "Dream Architect", "People's Champion"

  isAlive  Boolean @default(true)
  isPlayer Boolean @default(false)

  // ==== FAMILY RELATIONSHIPS (OPTION C) ====
  parent1Id Int?
  parent2Id Int?

  parent1 Person? @relation("Parent1Children", fields: [parent1Id], references: [id])
  parent2 Person? @relation("Parent2Children", fields: [parent2Id], references: [id])

  childrenAsParent1 Person[] @relation("Parent1Children")
  childrenAsParent2 Person[] @relation("Parent2Children")

  marriagesA Marriage[] @relation("PersonAMarriages")
  marriagesB Marriage[] @relation("PersonBMarriages")

  // Friendships (symmetric, stored as two directional edges)
  friendshipsA Friendship[] @relation("PersonAFriendships")
  friendshipsB Friendship[] @relation("PersonBFriendships")

  // ==== OPTION A + B ====
  employments Employment[]
  enrollments Enrollment[]

  // Industry/company hierarchy positions
  companyPositions CompanyPosition[]

  // ==== OPTION D: politics / prestige ====
  terms    Term[] // offices held over time
  prestige Int    @default(0)

  createdAt DateTime @default(now())
}

// Companies (jobs)
model Company {
  id   Int    @id @default(autoincrement())
  name String

  // Flexible string industry field (e.g. "TECH", "FINANCE", "RESEARCH")
  industry String

  world   World @relation(fields: [worldId], references: [id])
  worldId Int

  country   Country @relation(fields: [countryId], references: [id])
  countryId Int

  employments Employment[]

  // Industry hierarchy positions inside this company
  positions CompanyPosition[]

  createdAt DateTime @default(now())
}

// Jobs
model Employment {
  id Int @id @default(autoincrement())

  person   Person @relation(fields: [personId], references: [id])
  personId Int

  company   Company @relation(fields: [companyId], references: [id])
  companyId Int

  title     String
  salary    Int
  startYear Int
  endYear   Int?

  createdAt DateTime @default(now())
}

// Schools
model School {
  id       Int    @id @default(autoincrement())
  name     String
  level    String // "Primary" | "Secondary" | "University"
  prestige Int    // 1–100

  world   World @relation(fields: [worldId], references: [id])
  worldId Int

  country   Country @relation(fields: [countryId], references: [id])
  countryId Int

  enrollments Enrollment[]
  createdAt   DateTime     @default(now())
}

// Enrollments
model Enrollment {
  id Int @id @default(autoincrement())

  person   Person @relation(fields: [personId], references: [id])
  personId Int

  school   School @relation(fields: [schoolId], references: [id])
  schoolId Int

  startYear Int
  endYear   Int?

  createdAt DateTime @default(now())
}

// Marriages (Option C)
model Marriage {
  id Int @id @default(autoincrement())

  personA   Person @relation("PersonAMarriages", fields: [personAId], references: [id])
  personAId Int

  personB   Person @relation("PersonBMarriages", fields: [personBId], references: [id])
  personBId Int

  startYear Int
  endYear   Int?

  createdAt DateTime @default(now())
}

// Friendships (Option C)
model Friendship {
  id Int @id @default(autoincrement())

  personA   Person @relation("PersonAFriendships", fields: [personAId], references: [id])
  personAId Int

  personB   Person @relation("PersonBFriendships", fields: [personBId], references: [id])
  personBId Int

  strength Int // 1–100: how close they are

  createdAt DateTime @default(now())
}

// Political offices (Option D)
model Office {
  id         Int    @id @default(autoincrement())
  name       String // e.g. "World President", "President of Alboria"
  level      String // "World" | "Country"
  termLength Int    // in years
  prestige   Int    // 1–100, boosts winner prestige

  world   World @relation(fields: [worldId], references: [id])
  worldId Int

  country   Country? @relation(fields: [countryId], references: [id])
  countryId Int?

  terms Term[]

  createdAt DateTime @default(now())
}

// Terms of office
model Term {
  id Int @id @default(autoincrement())

  office   Office @relation(fields: [officeId], references: [id])
  officeId Int

  person   Person @relation(fields: [personId], references: [id])
  personId Int

  startYear Int
  endYear   Int?

  createdAt DateTime @default(now())
}

// ===============================
// Industry hierarchy models
// ===============================

// Defines a role within an industry hierarchy (e.g. President, VP, Manager).
// These are global templates keyed by a string industry name.
model IndustryRole {
  id       Int    @id @default(autoincrement())
  industry String // e.g. "TECH", "FINANCE", "RESEARCH"
  name     String // e.g. "President", "Vice President"
  rank     Int    // 0 = top of hierarchy, larger = lower tiers

  positions CompanyPosition[]

  createdAt DateTime @default(now())
}

// Connects a person to a company in a specific industry role.
// This is the BBGM-style "slot" in an industry hierarchy.
model CompanyPosition {
  id Int @id @default(autoincrement())

  company   Company @relation(fields: [companyId], references: [id])
  companyId Int

  person   Person @relation(fields: [personId], references: [id])
  personId Int

  role   IndustryRole @relation(fields: [roleId], references: [id])
  roleId Int

  startYear Int
  endYear   Int?

  createdAt DateTime @default(now())
}
